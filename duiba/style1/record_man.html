<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta content="telephone=no" name="format-detection"/>
    <title>兑换记录</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <link rel="stylesheet" href="../css/normalize.min.css?t=20151016">
    <link rel="stylesheet" href="../css/records-list-v1201.css?t=20151201">
    <style>
        .tooltip{color: #0b45fc;padding: 2px 5px;display:inline-block;background-color: #fff;border: solid #0b45fc 1px;font-size: 10px;position: relative;border-radius: 2px;font-style: normal;margin-left: 8px;}
        .tooltip::after{content: '';display: block;position: absolute;left:-5px;top:50%;margin-top:-3px;border: solid transparent 3px; border-right-color:#fff; }
        .tooltip::before{content: '';display: block;position: absolute;left:-6px;top:50%;margin-top:-3px;border: solid transparent 3px; border-right-color:#0b45fc; }
    </style>
</head>
<body>
<div id="db-content">
    <div class="records-list">
        <a href="/crecord/recordDetail/60719749?fromPage=record&dbnewopen">
            <input type="hidden" value="false"/>
            <div class="record-group " data-recordid="67477116">
                <img src="http://yun.duiba.com.cn/images/35q7ezcx0v.png?t=1">
                <div class="item-info">
                    <h2><i class="new-record"></i><span>测试专用优惠券</span></h2>
                    <p><span>有效期至：2016-12-31</span><i class='tooltip'>即将过期</i></p>
                </div>
            </div>
        </a>
        <a href="/crecord/recordDetail/60719660?fromPage=record&dbnewopen">
            <input type="hidden" value="false" />
            <div class="record-group " data-recordid="67477022">
                <img src="http://yun.duiba.com.cn/images/35q7ezcx0v.png?t=1">
                <div class="item-info">
                    <h2><span>测试专用优惠券</span></h2>
                    <p><span>有效期至：2016-12-31</span></p>
                </div>
            </div>
        </a>

        <a href="/crecord/recordDetail/60719588?fromPage=record&dbnewopen">
            <input type="hidden" value="false"></input>
            <div class="record-group " data-recordid="67476954">
                <img src="http://yun.duiba.com.cn/images/35q7ezcx0v.png?t=1">
                <div class="item-info">
                    <h2><span>测试专用优惠券</span></h2>
                    <p><span>有效期至：2016-12-31</span></p>
                </div>
            </div>
        </a>

        <a href="/crecord/recordDetail/60719329?fromPage=record&dbnewopen">
            <input type="hidden" value="false"></input>
            <div class="record-group " data-recordid="67476680">
                <img src="http://yun.duiba.com.cn/images/35q7ezcx0v.png?t=1">
                <div class="item-info">
                    <h2><span>测试专用优惠券</span></h2>
                    <p><span>有效期至：2016-12-31</span></p>
                </div>
            </div>
        </a>

        <a href="/crecord/recordDetail/60719244?fromPage=record&dbnewopen">
            <input type="hidden" value="false"></input>
            <div class="record-group " data-recordid="67476589">
                <img src="http://yun.duiba.com.cn/images/35q7ezcx0v.png?t=1">
                <div class="item-info">
                    <h2><span>测试专用优惠券</span></h2>
                    <p><span>有效期至：2016-12-31</span></p>
                </div>
            </div>
        </a>

        <a href="/crecord/recordDetail/60719177?fromPage=record&dbnewopen">
            <input type="hidden" value="false"></input>
            <div class="record-group " data-recordid="67476523">
                <img src="http://yun.duiba.com.cn/images/35q7ezcx0v.png?t=1">
                <div class="item-info">
                    <h2><span>测试专用优惠券</span></h2>
                    <p><span>有效期至：2016-12-31</span></p>
                </div>
            </div>
        </a>

        <a href="/crecord/recordDetail/60719102?fromPage=record&dbnewopen">
            <input type="hidden" value="false"></input>
            <div class="record-group " data-recordid="67476448">
                <img src="http://yun.duiba.com.cn/images/35q7ezcx0v.png?t=1">
                <div class="item-info">
                    <h2><span>测试专用优惠券</span></h2>
                    <p><span>有效期至：2016-12-31</span></p>
                </div>
            </div>
        </a>

        <a href="/crecord/recordDetail/60719032?fromPage=record&dbnewopen">
            <input type="hidden" value="false"></input>
            <div class="record-group " data-recordid="67476375">
                <img src="http://yun.duiba.com.cn/images/35q7ezcx0v.png?t=1">
                <div class="item-info">
                    <h2><span>测试专用优惠券</span></h2>
                    <p><span>有效期至：2016-12-31</span></p>
                </div>
            </div>
        </a>

        <a href="/crecord/recordDetail/60718962?fromPage=record&dbnewopen">
            <input type="hidden" value="false"></input>
            <div class="record-group " data-recordid="67476299">
                <img src="http://yun.duiba.com.cn/images/35q7ezcx0v.png?t=1">
                <div class="item-info">
                    <h2><span>测试专用优惠券</span></h2>
                    <p><span>有效期至：2016-12-31</span></p>
                </div>
            </div>
        </a>

        <a href="/crecord/recordDetail/60718905?fromPage=record&dbnewopen">
            <input type="hidden" value="false"></input>
            <div class="record-group " data-recordid="67476239">
                <img src="http://yun.duiba.com.cn/images/35q7ezcx0v.png?t=1">
                <div class="item-info">
                    <h2><span>测试专用优惠券</span></h2>
                    <p><span>有效期至：2016-12-31</span></p>
                </div>
            </div>
        </a>

        <a href="/crecord/recordDetail/60718833?fromPage=record&dbnewopen">
            <input type="hidden" value="false"></input>
            <div class="record-group " data-recordid="67476168">
                <img src="http://yun.duiba.com.cn/images/35q7ezcx0v.png?t=1">
                <div class="item-info">
                    <h2><span>测试专用优惠券</span></h2>
                    <p><span>有效期至：2016-12-31</span></p>
                </div>
            </div>
        </a>

        <a href="/crecord/recordDetail/60718762?fromPage=record&dbnewopen">
            <input type="hidden" value="false"></input>
            <div class="record-group " data-recordid="67476087">
                <img src="http://yun.duiba.com.cn/images/35q7ezcx0v.png?t=1">
                <div class="item-info">
                    <h2><span>测试专用优惠券</span></h2>
                    <p><span>有效期至：2016-12-31</span></p>
                </div>
            </div>
        </a>

        <a href="/crecord/recordDetail/60718690?fromPage=record&dbnewopen">
            <input type="hidden" value="false"></input>
            <div class="record-group " data-recordid="67476016">
                <img src="http://yun.duiba.com.cn/images/35q7ezcx0v.png?t=1">
                <div class="item-info">
                    <h2><span>测试专用优惠券</span></h2>
                    <p><span>有效期至：2016-12-31</span></p>
                </div>
            </div>
        </a>

        <a href="/crecord/recordDetail/60718627?fromPage=record&dbnewopen">
            <input type="hidden" value="false"></input>
            <div class="record-group " data-recordid="67475944">
                <img src="http://yun.duiba.com.cn/images/35q7ezcx0v.png?t=1">
                <div class="item-info">
                    <h2><span>测试专用优惠券</span></h2>
                    <p><span>有效期至：2016-12-31</span></p>
                </div>
            </div>
        </a>

        <a href="/crecord/recordDetail/60718275?fromPage=record&dbnewopen">
            <input type="hidden" value="false"></input>
            <div class="record-group " data-recordid="67475578">
                <img src="http://yun.duiba.com.cn/images/35q7ezcx0v.png?t=1">
                <div class="item-info">
                    <h2><span>测试专用优惠券</span></h2>
                    <p><span>有效期至：2016-12-31</span></p>
                </div>
            </div>
        </a>


    </div>

    <div class="loading"><img src="http://yun.duiba.com.cn/webapp/img/loading.gif"></div>

    <div class="nomore">已经没有更多了！</div>

    <div class="retry">加载失败，点击重试</div>

    <!-- 她社区定制,老用户查看历史记录 -->

</div>
</body>
<script src="../js/zepto.min.js"></script>
<script src="../js/fastclick.js"></script>
<script>
    $(function(){
        //fastclick
        Origami.fastclick(document.body);
        var
                NextPage=true,
                Page=1,
                IsLoading=false

        if(!NextPage && true){
            $('.nomore').show();
        }

        $(window).on('scroll',function(){
            var ScrollTop=$(window).scrollTop();
            var GroupHeight=$('.records-list').height();
            var WinHeight=$(window).height();
            if(NextPage){
                if(ScrollTop+WinHeight+75>=GroupHeight && !IsLoading){
                    Page++;
                    GetRecords();
                }
            }
        });
        $('.retry').on('click',function(){
            $(this).hide();
            GetRecords();
        })
        $('.records-list').on('click','.record-group',function(){
            $(this).find('.new-record').remove();
        })
        function GetRecords(){
            IsLoading=true;
            $('.loading').show()
            $.ajax({
                type:'POST',
                url:"mock/getRecord.json",
                dataType:'json',
                data:{page:Page},
                timeout:10000,
                success:function(result){
                    $('.loading').hide()
                    if(result.success){
                        IsLoading=false;
                        NextPage=result.nextPage;
                        if(!NextPage){
                            if(9739 != 1502){
                                $('.nomore').show();
                            }
                        }
                        var HTML='';
                        for(var i in result.records){
                            HTML+='<a href="'+result.records[i].url+'">'
                            if(result.records[i].invalid){
                                HTML+='<div class="record-group invalid">'
                            }else{
                                HTML+='<div class="record-group">'
                            }
                            HTML+='<img src="'+result.records[i].img+'">'+
                                    '<div class="item-info">';

                            if(result.records[i].new){
                                HTML+='<h2><i class="new-record"></i><span>'+result.records[i].title+'</span></h2>'
                            }else{
                                HTML+='<h2><span>'+result.records[i].title+'</span></h2>'
                            }
                            HTML+='<p>'+result.records[i].statusText+'</p>'+
                                    '</div>'+
                                    '</div>'+
                                    '</a>'
                        }
                        $('.records-list').append(HTML);
                    }else{
                        $('.retry').show();
                    }
                },
                error:function(){
                    $('.loading').hide()
                    $('.retry').show();
                }
            })
        }

    })
</script>
</html>